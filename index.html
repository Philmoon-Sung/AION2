<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AION - AI Music & Video (Firestore Realtime)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a031a; 
            color: #e0e0e0; 
            overscroll-behavior: none; 
        }
        .neon-accent { color: #8A2BE2; }
        .neon-accent-bg { background-color: #8A2BE2; }
        .sidebar-icon { transition: all 0.3s ease; }
        .sidebar-icon:hover { color: #8A2BE2; transform: scale(1.1); }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .glassmorphism {
            background: rgba(20, 10, 40, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }
        .scrollable-content::-webkit-scrollbar { width: 8px; }
        .scrollable-content::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
        .scrollable-content::-webkit-scrollbar-thumb { background: #8A2BE2; border-radius: 10px; }
        .scrollable-content::-webkit-scrollbar-thumb:hover { background: #701ebd; }
        
        /* Horizontal scrollbar style */
        .horizontal-scroll-container::-webkit-scrollbar {
            height: 8px;
        }
        .horizontal-scroll-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        .horizontal-scroll-container::-webkit-scrollbar-thumb {
            background: #8A2BE2;
            border-radius: 10px;
        }
        .horizontal-scroll-container::-webkit-scrollbar-thumb:hover {
            background: #701ebd;
        }

        .modal.hidden { display: none; }
        .modal-content { max-height: 80vh; }

        .item-action-icon-wrapper { 
            position: absolute;
            top: 0.25rem; /* Adjusted for smaller cards */
            right: 0.25rem; /* Adjusted for smaller cards */
            display: flex; 
            flex-direction: row; 
            align-items: center; 
            gap: 0.25rem; 
            z-index: 10;
        }
        .item-action-icon {
            background-color: rgba(0,0,0,0.6); /* Slightly less transparent */
            color: white;
            border-radius: 50%;
            cursor: pointer;
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
            opacity: 0; 
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 1.75rem; 
            height: 1.75rem; 
            font-size: 0.875rem; 
            padding: 0.3rem; 
        }
        .item-action-icon:hover { opacity: 1; transform: scale(1.15); }
        
        .recommend-checkbox-icon.recommended { color: #facc15; }
        .like-item-button.liked { color: #ef4444; }

        .subscribe-artist-icon { 
            color: #cbd5e1; 
            cursor: pointer;
            transition: color 0.2s ease-in-out, transform 0.2s ease-in-out;
            font-size: 0.75rem; 
            margin-left: 0.25rem; 
        }
        .subscribe-artist-icon.subscribed { color: #ef4444; }
        .subscribe-artist-icon:hover { transform: scale(1.2); }

        .youtube-playable:hover .item-action-icon { opacity: 0.8; }
        .youtube-playable { 
            position: relative; 
            width: 150px; /* Card width for horizontal scroll */
            flex-shrink: 0; 
        }
        .youtube-playable.grid-item { /* For items in the "New Uploads" grid */
            width: auto; /* Reset width for grid items */
        }


        .toast-message {
            position: fixed; bottom: 20px; left: 50%;
            transform: translateX(-50%); background-color: #8A2BE2;
            color: white; padding: 10px 20px; border-radius: 8px;
            z-index: 1000; opacity: 0; transition: opacity 0.5s ease-in-out;
            font-size: 0.9rem; box-shadow: 0 4px 15px rgba(138, 43, 226, 0.4);
        }
        .toast-message.show { opacity: 1; }

        .item-title { 
            font-size: 0.8rem; /* Slightly larger for title */
            font-weight: 500; 
            line-height: 1.3; 
            margin-top: 0.25rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            height: 2.6em; /* Approx 2 lines */
        } 
        .item-artist-info { /* Container for artist name and views */
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.7rem; /* Smaller for artist/views */
            line-height: 1.2;
            margin-top: 0.125rem;
        }
        .item-artist { 
            color: #a0aec0; /* Lighter gray for artist */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex-grow: 1; /* Allow artist name to take space */
        } 
        .item-views {
            color: #8A2BE2; /* Neon accent for views icon */
            margin-left: 0.25rem; /* Space before views */
            flex-shrink: 0; /* Prevent views from shrinking */
        }
        .item-tags { 
            font-size: 0.65rem; 
            line-height: 1.2; 
            color: #718096; /* Darker gray for tags */
            margin-top: 0.25rem;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        } 
        
        @media (min-width: 768px) { 
            .youtube-playable { width: 170px; } 
            .item-title { font-size: 0.85rem; height: 2.7em; } 
            .item-artist-info { font-size: 0.75rem; }
            .item-tags { font-size: 0.7rem; } 
        }
        .item-artist-name-wrapper { display: flex; align-items: center; overflow: hidden; }


        .playlist-card { /* ... playlist styles remain the same ... */ }
        .playlist-cover { /* ... playlist styles remain the same ... */ }
        .playlist-cover i { /* ... playlist styles remain the same ... */ }

        #mobileSidebar.hidden { transform: translateX(-100%); }
        #mobileSidebarOverlay.hidden { display: none; }

        .thumbnail-image-container {
            width: 100%;
            aspect-ratio: 16 / 9; 
            overflow: hidden;
            border-radius: 0.375rem; 
        }
        .thumbnail-image {
            width: 100%;
            height: 100%; 
            object-fit: cover;
        }

        .admin-only { display: none !important; } 
        body.admin-mode .admin-only { display: flex !important; }
        body.admin-mode .admin-only-inline { display: inline-block !important; }

        .user-logged-in .login-prompt { display: none; }
        .user-logged-out .user-actions, .user-logged-out .user-avatar-header { display: none; }
        .user-logged-out .nav-item[data-section="library"],
        .user-logged-out .nav-item[data-section="profile"] {
            display: none !important;
        }
    </style>
</head>
<body class="flex h-screen overflow-hidden user-logged-out">

    <aside id="desktopSidebar" class="hidden md:flex w-64 glassmorphism p-4 space-y-8 flex-col items-start fixed inset-y-0 left-0 z-30">
        <div class="flex items-center justify-start space-x-3 mb-10"> 
            <svg class="h-14 w-14 neon-accent" viewBox="0 0 24 24" fill="currentColor"> <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
            </svg>
            <h1 class="text-4xl font-bold">AION</h1> 
        </div>
        <nav class="space-y-4 flex-grow w-full">
            <a href="#" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-purple-700/30 transition-colors duration-200 active-nav" data-section="home">
                <i class="fas fa-home fa-fw text-xl sidebar-icon"></i>
                <span class="text-sm">홈</span>
            </a>
            <a href="#" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-purple-700/30 transition-colors duration-200" data-section="library">
                <i class="fas fa-list-alt fa-fw text-xl sidebar-icon"></i> 
                <span class="text-sm">플레이 리스트</span> 
            </a>
            <div id="exportContentButtonContainerSidebar" class="admin-only"> 
                 <button id="exportContentButtonSidebar" class="w-full flex items-center space-x-3 p-3 rounded-lg text-sm text-gray-300 hover:bg-blue-700/30 transition-colors duration-200">
                    <i class="fas fa-file-export fa-fw text-xl sidebar-icon"></i>
                    <span class="text-sm">JSON 내보내기</span>
                </button>
           </div>
            <a href="#" class="nav-item admin-only flex items-center space-x-3 p-3 rounded-lg hover:bg-purple-700/30 transition-colors duration-200" data-section="upload">
                <i class="fas fa-upload fa-fw text-xl sidebar-icon"></i>
                <span class="text-sm">업로드</span>
            </a>
        </nav>
        <div class="mt-auto w-full">
             <a href="#" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-purple-700/30 transition-colors duration-200" data-section="profile">
                <i class="fas fa-user-circle fa-fw text-xl sidebar-icon"></i>
                <span class="text-sm">프로필</span>
            </a>
        </div>
    </aside>

    <div id="mobileSidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden"></div>
    <aside id="mobileSidebar" class="fixed inset-y-0 left-0 w-64 glassmorphism p-4 space-y-8 flex flex-col items-start z-40 transform -translate-x-full transition-transform duration-300 ease-in-out md:hidden">
        <div class="flex items-center justify-between w-full mb-6">
            <div class="flex items-center space-x-3"> 
                <svg class="h-10 w-10 neon-accent" viewBox="0 0 24 24" fill="currentColor"> <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/> </svg>
                <h1 class="text-2xl font-bold">AION</h1> 
            </div>
            <button id="closeMobileSidebarButton" class="text-gray-400 hover:text-white">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>
        <nav class="space-y-3 flex-grow w-full">
            <a href="#" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-purple-700/30 transition-colors duration-200 active-nav" data-section="home">
                <i class="fas fa-home fa-fw text-lg sidebar-icon"></i>
                <span class="text-sm">홈</span>
            </a>
            <a href="#" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-purple-700/30 transition-colors duration-200" data-section="library">
                <i class="fas fa-list-alt fa-fw text-lg sidebar-icon"></i> 
                <span class="text-sm">플레이 리스트</span>
            </a>
             <div id="exportContentButtonContainerMobileSidebar" class="admin-only"> 
                 <button id="exportContentButtonMobileSidebar" class="w-full flex items-center space-x-3 p-3 rounded-lg text-sm text-gray-300 hover:bg-blue-700/30 transition-colors duration-200">
                    <i class="fas fa-file-export fa-fw text-lg sidebar-icon"></i>
                    <span class="text-sm">JSON 내보내기</span>
                </button>
            </div>
            <a href="#" class="nav-item admin-only flex items-center space-x-3 p-3 rounded-lg hover:bg-purple-700/30 transition-colors duration-200" data-section="upload">
                <i class="fas fa-upload fa-fw text-lg sidebar-icon"></i>
                <span class="text-sm">업로드</span>
            </a>
        </nav>
        <div class="mt-auto w-full">
             <a href="#" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-purple-700/30 transition-colors duration-200" data-section="profile">
                <i class="fas fa-user-circle fa-fw text-lg sidebar-icon"></i>
                <span class="text-sm">프로필</span>
            </a>
        </div>
    </aside>


    <main id="mainContentArea" class="flex-1 md:ml-64 h-screen flex flex-col">
        <header class="p-4 glassmorphism sticky top-0 z-20 flex-shrink-0">
            <div class="flex items-center justify-between">
                <button id="mobileMenuButton" class="text-gray-300 hover:text-white md:hidden mr-3">
                    <i class="fas fa-bars text-xl"></i>
                </button>
                <div class="flex-grow">
                </div> 
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <button id="loginButton" class="login-prompt neon-accent-bg text-white px-3 py-1.5 sm:px-4 sm:py-2 rounded-lg text-xs sm:text-sm font-semibold hover:bg-purple-700 transition-colors">
                        <i class="fab fa-google mr-2"></i> Google 로그인
                    </button>
                    <div class="user-actions items-center space-x-2 sm:space-x-4 hidden">
                        <img id="userAvatarHeader" src="https://placehold.co/40x40/7F00FF/FFFFFF?text=U" alt="User Avatar" class="user-avatar-header w-8 h-8 sm:w-10 sm:h-10 rounded-full cursor-pointer"> 
                        <button id="logoutButton" class="text-gray-300 hover:text-white px-3 py-1.5 sm:px-4 sm:py-2 rounded-lg text-xs sm:text-sm hover:bg-purple-700/30 transition-colors">
                            로그아웃
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="flex-grow p-4 sm:p-6 overflow-y-auto scrollable-content pb-6"> 
            <section id="home" class="content-section active">
                <div class="mb-8 sm:mb-10">
                    <h3 class="text-xl sm:text-2xl font-medium mb-3 sm:mb-4 flex items-center"><i class="fas fa-chart-line mr-2 neon-accent"></i>AION 차트 <span class="text-xs sm:text-sm text-gray-400 ml-2">(조회수 TOP 10)</span></h3>
                    <div id="aionChartContainerOuter" class="relative">
                        <div id="aionChartContainer" class="horizontal-scroll-container flex overflow-x-auto space-x-3 sm:space-x-4 pb-3">
                        </div>
                        <p id="aionChartPlaceholder" class="text-gray-400 text-sm absolute inset-0 flex items-center justify-center hidden">차트에 표시할 콘텐츠가 없습니다.</p>
                    </div>
                </div>

                <div class="mb-8 sm:mb-10">
                    <h3 class="text-xl sm:text-2xl font-medium mb-3 sm:mb-4 flex items-center"><i class="fas fa-star mr-2 neon-accent"></i>추천 음악</h3>
                    <div id="recommendedMusicContainerOuter" class="relative">
                        <div id="recommendedMusicContainer" class="horizontal-scroll-container flex overflow-x-auto space-x-3 sm:space-x-4 pb-3">
                        </div>
                        <p id="recommendedMusicPlaceholder" class="text-gray-400 text-sm absolute inset-0 flex items-center justify-center hidden">추천된 음악이 없습니다.</p>
                    </div>
                </div>

                <div class="mb-8 sm:mb-10">
                    <h3 class="text-xl sm:text-2xl font-medium mb-3 sm:mb-4 flex items-center"><i class="fas fa-compass mr-2 neon-accent"></i>AI 음악 둘러보기</h3>
                    <div id="discoverMusicContainerOuter" class="relative">
                        <div id="discoverMusicContainer" class="horizontal-scroll-container flex overflow-x-auto space-x-3 sm:space-x-4 pb-3">
                        </div>
                        <p id="discoverMusicPlaceholder" class="text-gray-400 text-sm absolute inset-0 flex items-center justify-center hidden">둘러볼 음악이 없습니다.</p>
                    </div>
                </div>

                <div class="mb-8 sm:mb-10">
                    <h3 class="text-xl sm:text-2xl font-medium mb-3 sm:mb-4 flex items-center"><i class="fas fa-music mr-2 neon-accent"></i>새로운 AI 음악 & MV (Grid View)</h3>
                    <div id="newUploadsContainer" class="grid grid-cols-2 gap-3 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 sm:gap-4">
                        <p id="newUploadsPlaceholder" class="text-gray-400 col-span-full text-sm">음악이나 뮤직비디오가 여기에 표시됩니다.</p>
                    </div>
                </div>
            </section>

            <section id="library" class="content-section">
                <h2 class="text-2xl sm:text-3xl font-semibold mb-4 sm:mb-6">플레이 리스트</h2> 
                <div class="space-y-8">
                    <div>
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-lg sm:text-xl font-medium">내 플레이리스트</h3>
                            <button id="createPlaylistButton" class="neon-accent-bg text-white px-3 py-1.5 sm:px-4 sm:py-2 rounded-lg text-xs sm:text-sm font-semibold hover:bg-purple-700 transition-colors">
                                <i class="fas fa-plus mr-1"></i> 새 플레이리스트
                            </button>
                        </div>
                        <div id="myPlaylistsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            <p id="myPlaylistsPlaceholder" class="text-gray-400 col-span-full text-sm">만든 플레이리스트가 없습니다. 로그인 후 이용해주세요.</p>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg sm:text-xl font-medium mb-3">좋아요 표시한 곡</h3>
                        <div id="likedSongsContainer" class="space-y-2">
                            <p id="likedSongsPlaceholder" class="text-gray-400 text-sm">아직 좋아요 표시한 곡이 없습니다. 로그인 후 이용해주세요.</p>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg sm:text-xl font-medium mb-3">구독한 AI 아티스트</h3>
                        <div id="subscribedArtistsContainer" class="space-y-2">
                             <p id="subscribedArtistsPlaceholder" class="text-gray-400 text-sm">아직 구독한 아티스트가 없습니다. 로그인 후 이용해주세요.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="upload" class="content-section admin-only"> 
                 <h2 class="text-2xl sm:text-3xl font-semibold mb-4 sm:mb-6">AI 콘텐츠 업로드</h2>
                <div class="glassmorphism p-6 sm:p-8 rounded-lg max-w-2xl mx-auto">
                    <form id="uploadForm" class="space-y-6">
                        <div>
                            <label for="uploadContentType" class="block text-sm font-medium mb-1">콘텐츠 유형</label>
                            <select id="uploadContentType" name="uploadContentType" class="w-full p-3 rounded-lg bg-black/30 border border-purple-700/50 focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none text-sm">
                                <option value="mv">AI 뮤직 비디오 (YouTube)</option>
                                <option value="music" disabled>AI 음악 (직접 업로드 - 추후 지원)</option>
                            </select>
                        </div>
                        <div id="youtubeLinkGroup">
                            <label for="uploadYoutubeLink" class="block text-sm font-medium mb-1">유튜브 영상 URL</label>
                            <input type="url" id="uploadYoutubeLink" name="uploadYoutubeLink" class="w-full p-3 rounded-lg bg-black/30 border border-purple-700/50 focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none text-sm" placeholder=